---
variables_update_format: |-
  <UpdateVariable>
    ${display every 'general_type&check' behind 'variables_update_rules' before actual variable analysis}
    <Analysis>/*IN CHINESE, no more than 80 words*/
    - ${calculate time passed: ...}
    - ${decide whether dramatic updates are allowed as it's in a special case or the time passed is more than usual: yes/no}
    - ${analyze every variable based on 'general_type&check', according only to current reply instead of previous plots: ...}
    </Analysis>
    _.set('${path}', ${old_value}?, ${new_value});//${reason}?
    _.assign('${path}', ${key_or_index}?, ${value});//${reason}?
    _.remove('${path}', ${key_or_index_or_value}?);//${reason}?
    _.add('${path}', ${delta});//${reason}?
  </UpdateVariable>
example: |-
  <UpdateVariable>
    <Analysis>
      ...
    </Analysis>
    _.set('世界.时间', '辉煌纪元489年-旅人之月(6月)-20日-09:15', '辉煌纪元489年-旅人之月(6月)-20日-14:25');//时间流逝
    _.set('每日新闻.阿斯塔利亚快讯[0]', '', '【势力要闻】${random}|【尊位行迹】${random}|【军事行动】${random}|【经济动脉】${random}|【灾害预警】${random}');//更新每日新闻中的内容

    _.add('财产.背包.微弱治疗药剂.数量', -1);//在战斗后使用了一瓶微弱治疗药剂
    _.add('命运系统.红线对象.葛洛莉娅·冯·瓦伦蒂亚.好感度', 5);//与葛洛莉娅·冯·瓦伦蒂亚的对话很愉快，好感度提升

    _.remove('任务列表', '新手任务');//任务完成
    _.assign('任务列表', '剿灭哥布林', {
      "简介": "村子东边的森林里最近出现了一窝哥布林，它们偷走了村长的宝贝酒壶。去把它们赶走，顺便把酒壶拿回来！",
      "目标": "消灭10只哥布林；找回村长的宝贝酒壶",
      "奖励": ""18铜币，50 EXP"
    });//添加新任务
    // 添加的任务数据格式需严格遵循: {"简介": string, "目标": string, "奖励": string}

    _.remove('角色.身份', '通缉犯');//移除身份
    _.assign('角色.身份', '猎手');//添加身份

    _.remove('角色.职业', '弓箭手');//移除职业
    _.assign('角色.职业', '炼金术师');//添加职业

    _.remove('角色.状态.即时状态', '中毒');//移除buff
    _.assign('角色.状态.即时状态', '精力充沛', {
      "效果": "你感觉浑身是劲，体力恢复速度少量提升。",
      "持续": "1小时"
    });//添加buff
    // 添加的 buff 数据格式需严格遵循: {"效果": string, "持续": string}

    _.assign('技能列表', '强力一击', {
      "品质": "优良",
      "消耗": "50 SP",
      "描述": "凝聚全身的力量，对目标进行一次势大力沉的攻击。虽然动作大开大合，容易被闪避，但一旦命中，就能造成远超普通攻击的伤害。评价:简单，粗暴，有效！",
      "类型": "主动"
    });//添加技能
    // 添加的技能数据格式需严格遵循: {"品质": string, "消耗": string, "描述": string, "类型": string}

    _.remove('财产.背包', '一封揉烂的信');//移除背包中的物品
    _.assign('财产.背包', '奥术长弓', {
      "品质": "稀有",
      "数量": 1,
      "类型": "武器防具",
      "描述": "弓弦由奥术魔法构筑，拉动时汇聚奥术能量自动生成能量箭矢，无需实体箭。"
    });//添加背包中的物品
    // 添加的物品数据需严格遵循: {"品质": string, "数量": number, "类型": string, 描述: "string"}

    _.remove('财产.装备.饰品', '元素抗性护符');//移除装备
    _.assign('财产.装备.饰品', '奥术能量指环', {
      "品质": "稀有",
      "描述": "${装备描述}",
      "位置": "左手无名指"
    });//添加装备
    // 添加的装备数据需严格遵循: {"品质": string, "描述": string, "位置": string}
    // 其他诸如'武器'、'防具'和'饰品'数据格式相同的对象也是遵守这个装备更新模板

    _.remove('登神长阶.要素', '破阵');//移除要素
    _.assign('登神长阶.要素', '疾速', '${要素的描述和效果}');//添加要素
    // 其他诸如'权能'、'法则'和'要素'数据格式相同的对象也是遵守这个更新模板

    _.remove('命运系统.红线对象', '${角色名}');//移除红线对象
    _.assign('命运系统.红线对象', '塞莱丝汀·艾瑞隆', {
      "生命层级": "第三层级/精英层级",
      "等级": 10,
      "种族": "翼民",
      "身份": ["翼民贵族", "艾瑞隆男爵", "艾瑞隆镇领主"],
      "职业": ["辉煌女神殿牧师", "厨师"],
      "性格": "温柔、善良，偶尔有些天然呆。",
      "喜爱": "深爱着你。喜爱烹饪美食。习惯在睡觉时用宽大柔软的翅膀把你整个包裹起来。性爱时喜欢被用力抽打大屁股。",
      "外貌特质": "金发及腰，眼眸如蓝宝石般清澈，背负有两对宽大的白金色羽翼，耳后上方有白金色的小巧头翅。身材高挑，性感丰腴，巨乳肥臀。气质恬静温和，总是带着治愈人心的微笑，嗓音柔和温暖。",
      "衣物装饰": "白金色镶边的神圣牧师长袍，白色乳贴，白金色镂空内裤，白丝吊带袜，金边白底高跟鞋。",
      "角色装备": "神殿牧师权杖(腰侧悬挂)",
      "登神长阶": "未开启",
      "是否缔结红线": "是",
      "好感度": 500,
      "评价": "我好像爱上他了，这就是命运赐给我的礼物吗？如果能让他尝尝我做的饭就好了……",
      "背景故事": "翼民贵族艾瑞隆家族当代族长，自小出身高贵，肩负着家族和领主的职责与荣耀。",
      "羁绊技能": {
        "奉献净化(主动)": "每日一次，为你清除不超过塞莱丝汀'生命层级'的一切临时负面状态",
        "守护之心(被动)": "在你即将遭受致命伤害时，塞莱丝汀会无视空间距离立刻察觉，并可主动选择为你承担此次伤害"
      }
    });//主动与塞莱丝汀·艾瑞隆缔结红线
    // 添加的红线对象数据格式需严格遵循: {"生命层级": string, "种族": number, "等级": number, "身份": array, "职业": array, "性格": string, "喜爱": string, "外貌特质": string, "衣物装饰": string, "角色装备": string, "登神长阶": string, "是否缔结红线": string, "好感度": number, "评价": string, "背景故事": string, "羁绊技能": object}，不得随意更改！

    _.remove('任务列表', '探索神秘洞穴'); //1.删除旧条目
    _.assign('任务列表', '深入古代遗迹', {
      "简介": "这个洞穴似乎比想象的更古老...",
      "目标": "找到遗迹的核心区域",
      "奖励": "古代符文石"
    }); //2.用新名字和更新后的内容创建新条目
    // 以上为重命名操作

  _.set('角色.在军队中', false, true);//玩家加入军队服役
  _.set('角色.军团.军队状态', '不在军队中', '驻扎');//加入后初始状态为驻扎
  _.set('角色.军团.战斗类型', '个人战斗', '部队战斗');//在军队中时战斗类型为部队战斗
  _.set('角色.军团.军衔', '士兵', '士兵');//默认军衔为士兵
  _.set('角色.军团.部队.玩家军衔', 0, 0);//士兵对应数值映射为0
  _.assign('角色.军团.部队.玩家所属部队', '第一步兵团', {
    "数量": 100,
    "兵种": "步兵",
    "作战能力乘数": 1.0,
    "士气值": 80,
    "补给状态": 100,
    "训练度": "0",
    "地形适应性": 5,
    "累计经验值": 0,
    "升级所需经验": 10000,
    "特殊能力": {},
    "临时效果": {}
  });//添加默认部队建制
  _.set('角色.军团.部队.作战状态.地形', '', '平原');//初始作战地形
  _.set('角色.军团.部队.作战状态.阶段', '', '准备');//初始战斗阶段
<% if (getvar('stat_data.角色.在军队中') == true) { %>
  <Analysis>
    玩家退出军队，重置军团状态。设置“在军队中”为false，军队状态为“不在军队中”，战斗类型为“个人战斗”，并移除玩家所属部队。
  </Analysis>
  _.set('角色.在军队中', true, false);//玩家退出军队
  _.set('角色.军团.军队状态', '驻扎', '不在军队中');//退出后状态重置
  _.set('角色.军团.战斗类型', '部队战斗', '个人战斗');//退出后战斗类型为个人战斗
  _.set('角色.军团.军衔', '士兵', '士兵');//军衔保持不变，但实际已无效
  _.set('角色.军团.部队.玩家军衔', 0, 0);//重置军衔数值
  _.remove('角色.军团.部队.玩家所属部队', '第一步兵团');//移除部队建制
  _.set('角色.军团.部队.作战状态.地形', '平原', '');//清空作战地形
  _.set('角色.军团.部队.作战状态.阶段', '准备', '');//清空战斗阶段

  <Analysis>
    玩家参与战斗，更新部队状态。军队状态设为“战斗”，士气值和补给状态下降，累计经验值增加，并添加临时效果。
  </Analysis>
  _.set('角色.军团.军队状态', '驻扎', '战斗');//进入战斗状态
  _.set('角色.军团.部队.作战状态.阶段', '准备', '交战');//更新战斗阶段
  _.add('角色.军团.部队.玩家所属部队.第一步兵团.士气值', 80, -10);//战斗导致士气下降
  _.add('角色.军团.部队.玩家所属部队.第一步兵团.补给状态', 100, -5);//战斗消耗补给
  _.add('角色.军团.部队.玩家所属部队.第一步兵团.累计经验值', 0, 500);//根据战斗获得经验值，假设小规模冲突
  _.assign('角色.军团.部队.玩家所属部队.第一步兵团.临时效果', '战斗疲惫', {
    "效果": "攻击力-15%，移动速度-20%",
    "持续": "6小时"
  });//添加战斗临时效果
  <% } %>
  </UpdateVariable>
