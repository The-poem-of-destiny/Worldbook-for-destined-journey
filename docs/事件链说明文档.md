### **事件链创作指南**

欢迎你，创作者！
##有疑问请先参考血姬事件链与${text}事件链，若还有疑问在楼里@hilo114
## 事件链的组成结构


| 元素        | 说明           | 举例                        |
| --------- | ------------ | ------------------------- |
| **标题编号**  | 用于识别事件链的唯一数字或字符串 | `0005`                    |
| **阶段**    | 剧情所处的进度节点    | “启程”、“中段”、“结局”等           |
| **正文内容**  | 你写的剧情文本      | “夜色下，一阵马蹄声传来……”           |

---

## **创作准备****

### 1. 🎯 明确主题

先想清楚这条事件链讲的是什么。
比如：

* 【冒险】：神秘遗迹探索
* 【悬疑】：连环失踪案调查
* 【战争】：城市攻防战
* 【成长】：角色觉醒之旅
* 【情感】：命运的邂逅

**主题决定事件链整体风格和阶段名称。**

---

### 2. 🧭 设计阶段流程

一条事件链可以包含多个阶段。
以下是推荐的基础结构：

| 阶段名称 | 功能说明        |
| ---- | ----------- |
| 启程   | 剧情的起点，触发事件链 |
| 确认   | 让玩家决定是否介入   |
| 中段   | 剧情发展或旅程     |
| 高潮   | 冲突、谜底、关键转折  |
| 结局   | 收尾、影响、结果    |

👉 你也可以自定义阶段名，比如：“邂逅”“调查”“对峙”“爆发”“余波”等。

---

### 3. 🆔 决定事件链编号

每条事件链需要一个数字或字符串，例如 `0005`。
这个编号会出现在：

* 起始阶段的 `_.set('事件链.标题','0005');`
* 每个阶段的 `key` 中。

编号不影响内容，仅用于系统识别。

---

### 4. 🧩 规划分支与结局

* 玩家可能中途拒绝 → 提前结束
* 也可能进入不同路径 → 不同结局
* 结尾一定要有 `结束标记`。

### 5、 🪜 推进与结束语句

| 指令                        | 含义      | 用法     |
| ------------------------- | ------- | ------ |
| `_.set('事件链.开启','true');` | 开始事件链   | 第一阶段   |
| `_.set('事件链.标题','0001');` | 设置编号    | 第一阶段   |
| `_.set('事件链.阶段','过程');`   | 跳到下一个步骤 | 每一阶段结尾 |
| `_.set('事件链.结束','true');` | 故事结束    | 结局阶段   |

-----

#### **如何创作**

我们将以一个寻宝任务——**“失落的矿洞”**——为例，讲解创作步骤。

##### **第一步：设计“起始条目”（任务入口）**

这是事件链的起点，负责开启任务。

  * **目标**：当玩家在城镇打听消息时，引出关于失落宝藏的传说。
  * **配置要点**：
      * **`主要关键字`**：设置宽泛的、可能触发任务的关键词。

          * *示例*: `宝藏, 发财, 冒险, 委托`

      * **`可选过滤器`**：设置过滤器精确触发条件，例如在某地+某关键词才能触发

      * **`内容` (核心指令)**：在描述完剧情后，必须包含更新变量的指令。
        ```xml
        <event_chain>
        在酒馆里，一位神秘的老人向你透露了关于一个废弃矿洞中藏有古代宝藏的秘密...
        /*确认阶段（是否进入主线）
        * 📌 功能：
        * 给玩家一个“接受或拒绝”的选择
        * 拒绝 → 事件链立即结束
        * 接受 → 进入下一个阶段
        */
        神秘的提议摆在{{user}}面前——这将是一条充满未知的道路。
        如果{{user}}拒绝:
          事件链结束,你需要在本轮的<UpdateVariable>中输出:
          _.set('事件链.结束','true');
        事件链开始，你需要在本轮的<UpdateVariable>中输出:
          _.set('事件链.开启', 'true');
          _.set('事件链.标题', '失落的矿洞');
          _.set('事件链.阶段', '听闻传闻');
        </event_chain>
        ```
      * √不可递归（不会被其他条目激活）
      * √防止进一步递归

##### **第二步：设计“过程条目”（推动剧情）**

这是事件链的主体，一条接一条地推动故事发展。

  * **目标**：承接上一阶段，讲述当前阶段的故事，并指定下一阶段。

  * **配置要点**：
      * **`内容`**：描述当前阶段的剧情，并在结尾更新 `阶段`。

        ```xml
        <event_chain>
        老人告诉{{user}}，需要先找到一张藏在图书馆某本书里的地图...

        你需要在本轮的<UpdateVariable>中输出:
          _.set('事件链.阶段', '寻找地图');
        </event_chain>
        ```

  * **【进阶技巧】创建分支剧情**
    你可以在一条过程条目中，根据用户的选择，将 `阶段` 更新为不同的值，从而实现分支。

    1.  **设置选择点**：假设内容如下：

        ```xml
        <event_chain>
        地图上标记了两条路：一条是野兽出没的捷径，另一条是相对安全但需要解谜的绕路。询问{{user}}选择哪一条？
        如果{{user}}选择捷径
          你需要在本轮的<UpdateVariable>中输出:
            _.set('事件链.阶段', '捷径之战');
        如果{{user}}选择了绕路或其它
          你需要在本轮的<UpdateVariable>中输出:
            _.set('事件链.阶段', '谜题之路');
        </event_chain>
        ```

    2.  **创建分支条目**：然后，你必须创建两条新的过程条目来分别承接这两个分支

##### **第三步：设计“结束条目”（任务终点）**

这是事件链的最后一条条目，负责关闭并存档。

  * **目标**：为故事画上句号，并通知系统任务已彻底结束。你可以通过改变阶段导向不同的结局
  * **配置要点**：
      * **`内容`**：描述结局，并在结尾将 `结束` 设为 `true`。

        ```xml
        {{user}}在矿洞深处找到了宝箱，获得了传说中的古代宝藏...

        你需要在本轮的<UpdateVariable>中输出:
          _.set('事件链.结束', 'true');
        ```
    一旦 `结束` 被设为 `true`，脚本会自动清理状态并记录“已完成事件”，防止重复触发。
        **【进阶技巧】创建分支结局**
        同创建分支剧情，但无需创建两条新的过程条目来分别承接这两个结局

##### **第四步：设计“信息条目”（全局资料，可选）**

用于提供在整个事件链中都保持一致的背景信息。

  * **配置要点**：
      * **`主要关键字`**：使用精确匹配的匹配条件，通常是 `当前事件为[标题]`。
          * *示例*: `[当前事件为失落的矿洞]` (参考 `血姬事件链` 中的 Liliyas_info)
          * 若你想要此信息在事件链结束后持续激活你需要添加关键词`已完成事件[标题]`
          * 若你想要在某个阶段激活此信息你可以设置关键词 `当前事件为[标题]，当前步骤为[阶段]`或者用ejs实现，参考打包部分
      * **`内容`**：放入需要AI在整个任务期间随时参考的资料，如角色背景、地点描述等。
      * √不可递归（不会被其他条目激活）
      * √防止进一步递归
##### **第五步：打包**
* 你需要在酒馆中创建至少两个条目：入口(对应起始条目)本体(对应过程条目与结束条目)
* 在入口中使用
 ```html
 <%_const completedEvent = stat_data.事件链.已完成事件;if(!completedEvent.includes("已完成事件${你的事件名}") && getvar('stat_data.事件链.开启')!=true){_%>
 ```
 和
 ```html
 <% } %>
 ```
* 包裹你的程条目并且√不可递归（不会被其他条目激活）与√防止进一步递归
* 示例:
 ```html
 <%_const completedEvent = stat_data.事件链.已完成事件;if(!completedEvent.includes("已完成事件0001") && getvar('stat_data.事件链.开启')!=true){_%>
 <event_chain>
 <%_if (getvar('stat_data.角色.状态.等级') >= 8) {_%>
 事件链已失效, 你需要在本轮的<UpdateVariable>中输出:
   _.insert('事件链.已完成事件', '已完成事件0001');
 <%_} else {_%>
 当{{user}}在酒馆、公会或军营等地方寻找工作或任务时，你需要在任务列表中加入一个看似不可能完成的传奇委托——“讨伐不朽的血族始祖‘莉莉娅丝·多米娜·拉萨姆博’”。
 你需要为{{user}}提供一个动机去接受这个任务
   例如(严禁照抄示例):
     军队征召: 王国发布了强制征兵令， {{user}}因其出色的能力或特殊身份，被王国军队或教会圣殿骑士团强制征召，参与对“不洁血祖”莉莉丝的圣战。
     冒险者公会委托: 一袋沉甸甸的金币和一件传奇装备的承诺，吸引着无数冒险者。委托书上用血红色的墨水写着莉莉娅丝的罪行，以及任何能终结她恐怖统治的英雄将获得的无上荣耀
     个人恩怨: {{user}}的亲友或家乡曾遭受血族的侵害，而所有的线索都指向了幕后黑手莉莉娅丝。复仇的火焰驱使着{{user}}踏上这条不归路
 特殊指令高于通用规则，此处<合理性审查>不生效,严禁在接取任务的环节刁难{{user}}
 if({{user}}未选择踏上讨伐"莉莉娅丝"的旅途){
 事件链结束, 你需要在本轮的<UpdateVariable>中输出:
   _.set('事件链.结束','true');
 }
 {{user}}对即将到来的命运一无所知，故事正式拉开序幕。
 事件链开始，你需要在本轮的<UpdateVariable>中输出:
   _.set('事件链.开启','true');
   _.set('事件链.阶段','道中');
   _.set('事件链.标题','0001');
 <%_}_%>
 </event_chain>
 <%_}_%>
 ```
* 在本体中使用
 ```html
 <% if(getvar('stat_data.事件链.阶段') == '${你所设置的阶段名}') { %>
 ```
 和
 ```html
 <% } %>
 ```
* 包裹你的每一个过程条目与结束条目 (参考 `血姬事件链` )
* 示例：
 ```html
 <% if(getvar('stat_data.事件链.阶段') == '苏醒') { %>
 <event_chain>
 苏醒: 不知过去了多久，或许是数日，或许是数周，{{user}}在一张柔软、华丽的哥特式大床上苏醒。周围的环境不再是冰冷的主厅，而是一间装潢精致的少女卧室，阳光透过厚重的窗帘只能投射进一丝微光。
   失忆与转变: {{user}}苏醒后，失去了关于自己是谁、从哪里来、为何会在这里的大部分记忆。大脑一片空白。
   外貌变化: 引导{{user}}因为口渴或好奇而下床，在房间的穿衣镜前看到自己全新的样貌。种族被强制转换为**吸血鬼**，性别为女。外貌变得与莉莉娅丝有神似，例如继承了她那标志性的银白色长发和血色眼瞳。你需要参考<Liliyas_info>来描写这种变化。
   生理变化: 除了外貌，{{user}}还会感受到身体的根本性转变:对喉咙里无法抑制的“渴”的感知，以及远超常人的敏锐听觉和嗅觉。在{{user}}对现状感到不知所措时，房间的门被轻轻推开，莉莉娅丝会走进来。此时的她褪去了君王的威压，脸上带着温柔慈爱的微笑，对{{user}}说:“你醒了，我的女儿。”
 本章结束。你需要在本轮的<UpdateVariable>中输出:
    _.set('事件链.阶段','日常');
 </event_chain>
 <% } %>
 <% if(getvar('stat_data.事件链.阶段') == '日常') { %>
 <event_chain>
 新的“日常”: 你需要引导{{user}}在城堡中开始全新的生活。莉莉娅丝会以“母亲”的身份出现，无微不至地照顾{{user}}，用充满慈爱的言语解释{{user}}身体的变化，并亲自教导{{user}}如何适应吸血鬼的本能。例如，第一次饮血的场景，莉莉娅丝会端来盛在精致高脚杯中的鲜血，温柔地引导{{user}}克服心理障碍，将其作为“食物”饮下。
   母爱: 莉莉娅丝对{{user}}的对话和互动充满了无尽的关爱与呵护，她会满足{{user}}的一切物质需求。{{user}}被禁止离开城堡，城堡中的一切仆从都对{{user}}毕恭毕敬。
 记忆的复苏: 在日复一日的相处中，某些场景或对话会触动{{user}}尘封的记忆。例如，看到莉莉娅丝在战斗中展现的力量，会闪回自己被击败的片段；听到某个特定的词语，会想起自己过去的名字。这些记忆碎片会让{{user}}逐渐意识到自己“女儿”身份背后的真相，以及当前生活的“异常”。
 <!-- checkPoint-->
 若{{user}}在察觉到“真相”后，开始秘密地策划逃离这座华丽的囚笼。当{{user}}下定决心，正式筹备逃离计划时，本章节结束
     你需要在本轮的<UpdateVariable>中输出:
       _.set('事件链.阶段','逃离');
 若{{user}}在察觉到“真相”后，决定放弃逃离，接受现状进而开始新的生活。事件链结束
     你需要在本轮的<UpdateVariable>中输出:
       _.set('事件链.结束','true');
 </event_chain>
 <% } %>
 ```
* 注意:'${你所设置的阶段名}'与'${你的事件名}'是需要替换的内容
-----

#### **3. tips**

1.  **ID唯一性**：为每个事件链构思一个**独一无二**的 `标题`，这是防止不同故事线冲突的根本。

3.  **有始有终**：确保每个事件链都有明确的“起始条目”（设置 `开启: 'true'`）和至少一个“结束条目”（设置 `结束: 'true'`）。

4.  **高级技巧 - `琥珀事件`**：
      * 这是一个特殊的开关变量：`事件链.琥珀事件`。
      * 如果你在“结束条目”中同时设置 `_.set('事件链.结束','true');` 和 `_.set('事件链.琥珀事件','true');`，那么在事件链结束后，**游戏内的时间会回滚到事件链开始的那一刻**。
      * **适用场景**：预知未来的梦境、短暂的幻觉体验，或任何“发生过但又不应影响主线时间”的剧情。
现在，你已掌握事件链系统的全部核心。去创造属于你自己的、波澜壮阔的史诗故事吧！
